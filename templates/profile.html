{% extends "layout.html" %}

{% block body %}
    <div class="container">

        <div class="row">
            <div class="col-md-3">
                <h1 class="h3 mb-2">Perfil</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Detalles Perfil</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="{{ user.foto }}" class="img-fluid foto_perfil" width="128" height="128">
                        <h4 class="card-title mb-0">{{ user.nombres }} {{ user.apellidos }}</h4>
                        <div class="text-muted mb-2">Usuario de la Red Social</div>
                    </div>
                </div>
                <div class="d-flex justify-content-center pb-2">
                    {% if not propio_perfil %}
                        {% if estado_amistad == 2 %}
                            <button type="button" class="btn btn-success btn-sm" disabled>Actualmente amigos</button>
                        {% elif estado_amistad == 1 %}
                            <button type="button" class="btn btn-info btn-sm" disabled>Invitacion pendiente</button>
                        {% elif estado_amistad == 5 %}
                            <button type="button" class="btn btn-primary btn-sm mr-2">Aceptar</button>
                            <button type="button" class="btn btn-danger btn-sm">Rechazar</button>
                        {% else %}
                            <button type="button" class="btn btn-primary btn-sm">Agregar amigo</button>
                        {% endif %}
                    {% endif %}
                </div>

                <div class="tab-pane fade in active show" id="profile-friends">
                    <h4 class="m-t-0 m-b-20">Lista de amigos ({{ amigos|length }})</h4>
                    {% for amigo in amigos %}
                        <div class="row row-space-2">
                            <div class="col-md-12 m-b-2">
                                <div class="p-10 bg-white">
                                    <div class="media media-xs overflow-visible">
                                        <a class="media-left" href="/profile?user={{amigo.id}}">
                                            <img src="{{ amigo.foto }}" alt=""
                                                 class="media-object img-circle">
                                        </a>
                                        <div class="media-body">
                                            <b class="text-inverse">{{ amigo.nombres }} {{ amigo.apellidos }}</b>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

            </div>

            <div class="col-md-8 ">
                {% if propio_perfil or estado_amistad == 2 %}
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Nueva Publicación</h5>
                        </div>
                        <div class="card-body h-100">
                            <form action="/post_comment/{{ user.id }}" method="POST">
                                <div class="form-group">
                                <textarea name="texto_publicacion" class="form-control rounded-1"
                                          placeholder="Escribe un comentario ..." id="exampleFormControlTextarea1"
                                          rows="2"></textarea>
                                </div>

                                <div class="d-flex justify-content-end">
                                    <button type="submit" class="btn btn-primary btn-sm ">Publicar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                {% endif %}
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Actividades</h5>
                    </div>
                    <div class="card-body h-100">

                        {% for c in comentarios %}

                            <div class="media">
                                <img src="{{ c.foto }}" width="36" height="36" class="rounded-circle mr-2">
                                {% if c.u_postea == user.id %}
                                    <div class="media-body">
                                        <small class="float-right text-navy">5m ago</small>
                                        <strong>{{ c.nombres }} {{ c.apellidos }}</strong> {{ c.texto }}
                                        <br>
                                        <small class="text-muted">{{ c.fecha }}</small>
                                        {% if propio_perfil or estado_amistad == 2 %}
                                            <div class="comment-meta">
                                                <div class="d-flex justify-content-end">
                                                    {% if propio_perfil %}
                                                        <span><a
                                                                href="/delete_commmet/{{ c.id }}">Eliminar | </a></span>
                                                    {% endif %}

                                                    <span>
                                                    <a class="" role="button" data-toggle="collapse"
                                                       href="#replyCommentT{{ c.id }}" aria-expanded="false"
                                                       aria-controls="collapseExample"> Responder</a>
                                                    </span>

                                                </div>
                                                <div class="collapse" id="replyCommentT">
                                                    <form action="/reply_comment/{{ c.id }}" method="POST">
                                                        <div class="form-group">
                                                        <textarea name="comment" placeholder="Tu comentario ..."
                                                                  class="form-control" rows="3"></textarea>
                                                        </div>
                                                        <div class="d-flex justify-content-end">
                                                            <button type="submit" class="btn btn-warning btn-sm ">Enviar
                                                            </button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        {% endif %}
                                        <br>
                                    </div>
                                {% else %}
                                    <div class="media-body">
                                        <small class="float-right text-navy">30m ago</small>
                                        <strong>{{ c.nombres }} {{ c.apellidos }}</strong> publicó en el perfil de
                                        <strong>{{ user.nombres }} {{ user.apellidos }}</strong>
                                        <br>
                                        <small class="text-muted">{{ c.fecha }}</small>
                                        <div class="border text-sm text-muted p-2 mt-1">
                                            {{ c.texto }}
                                        </div>
                                        {% if propio_perfil or estado_amistad == 2 %}
                                            <div class="comment-meta">
                                                <div class="d-flex justify-content-end">
                                                    {% if propio_perfil %}
                                                        <span><a
                                                                href="/delete_commmet/{{ c.id }}">Eliminar | </a></span>
                                                    {% endif %}
                                                    <span>
                                        <a class="" role="button" data-toggle="collapse" href="#replyCommentT{{ c.id }}"
                                           aria-expanded="false" aria-controls="collapseExample"> Responder</a>
                                      </span>
                                                </div>
                                                <div class="collapse" id="replyCommentT{{ c.id }}">
                                                    <form action="/reply_comment/{{ c.id }}" method="POST">
                                                        <div class="form-group">
                                                        <textarea name="comment" placeholder="Tu comentario ..."
                                                                  class="form-control" rows="3"></textarea>
                                                        </div>
                                                        <div class="d-flex justify-content-end">
                                                            <button type="submit" class="btn btn-warning btn-sm ">Enviar
                                                            </button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endif %}

                            </div>
                            <hr>

                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
